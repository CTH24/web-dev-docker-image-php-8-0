################################################################################
#                                                                              #
#                     web-dev-docker-image-php-8-0                             #
#                                                                              #
#  Company: CTH24                                                              #
#  Author:  Daniel Hoffmann                                                    #
#  Github:  https://github.com/CTH24/web-dev-docker-image-php-8-0              #
#  Website: https://cth24.com                                                  #
#                                                                              #
################################################################################




################################################################################
# Base Image                                                                   #
################################################################################

FROM ubuntu:jammy




################################################################################
# Expose Ports                                                                 #
################################################################################

EXPOSE 80 443




################################################################################
# SET ENV Variables                                                            #
################################################################################

ENV DEBIAN_FRONTEND=noninteractive




################################################################################
# Update                                                                       #
################################################################################

RUN apt-get update && apt-get upgrade -y && apt-get autoremove -y




################################################################################
# Install Basic Packages                                                       #
################################################################################

RUN apt-get install -y \
    curl \
    software-properties-common




################################################################################
# Locales                                                                      #
################################################################################

RUN apt-get install -y \
    locales \
    && locale-gen en_US.UTF-8




################################################################################
# Add PHP repository                                                           #
################################################################################

RUN add-apt-repository ppa:ondrej/php 




################################################################################
# Install PHP 8.0                                                              #
################################################################################

RUN apt-get install -y \
    php8.0 \
    php8.0-curl \
    php8.0-fpm \
    php8.0-gd \
    php8.0-imagick \
    php8.0-intl \
    php8.0-mbstring \
    php8.0-mysql \
    php8.0-redis \
    php8.0-soap \
    php8.0-xdebug \
    php8.0-xml \
    php8.0-xmlrpc \
    php8.0-zip 




################################################################################
# Copy PHP Configuration                                                       #
################################################################################

COPY ./config/php/php.ini /etc/php/8.0/fpm/php.ini




################################################################################
# Install NGINX
################################################################################

RUN apt-get install -y nginx
COPY ./config/nginx/nginx.conf /etc/nginx/sites-available/localhost
RUN chmod 660 /etc/nginx/sites-available/localhost \
    && unlink /etc/nginx/sites-enabled/default \
    && ln -s /etc/nginx/sites-available/localhost /etc/nginx/sites-enabled/ \
    && nginx -t \
    && rm /var/www/html/*




################################################################################
# Entrypoint
################################################################################

COPY docker-entrypoint.sh /usr/local/bin/
RUN chmod +x /usr/local/bin/docker-entrypoint.sh
ENTRYPOINT ["docker-entrypoint.sh"]




